---
import { getCollection } from "astro:content";
import Pagination from "@components/blog/pagination.astro";
import Posts from "@components/blog/posts.astro";
import Container from "@components/container.astro";
import Sectionhead from "@components/sectionhead.astro";
import Layout from "@layouts/Layout.astro";
import { getLangFromUrl } from "../../../i18n/utils";

export async function getStaticPaths({ paginate }) {
  const lang = "vi"; // Folder identifier
  
  const allPosts = await getCollection("blog", ({ id, data }) => {
    // 1. Must be in the 'vi' folder
    // 2. Must NOT be the 'keep' file
    // 3. Must NOT be a draft
    return id.startsWith(`${lang}/`) && !id.endsWith('keep') && !data.draft;
  });

  allPosts.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());

  return paginate(allPosts, {
    pageSize: 10,
  });
}

const { page } = Astro.props;
const safeUrl = Astro.url;
const lang = getLangFromUrl(safeUrl);
---

<Layout title="Blog">
  <Container>
    <Sectionhead>
      <Fragment slot="title">Blog của chúng tôi</Fragment>
      <Fragment slot="desc">Khám phá thông tin chi tiết về ngành và ý kiến chuyên gia.</Fragment>
    </Sectionhead>
    
    {page.data.length > 0 ? (
      <Posts posts={page.data} />
      <Pagination class="mt-20" prevUrl={page.url.prev} nextUrl={page.url.next} />
    ) : (
      <div class="py-20 text-center">
        <p class="text-gray-500 text-xl">Hiện chưa có bài viết nào.</p>
      </div>
    )}
  </Container>
</Layout>