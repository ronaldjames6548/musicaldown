---
// src/pages/debug-blog.astro
// Temporary page to debug blog content structure
// Access at: http://localhost:4321/debug-blog

import { getCollection } from "astro:content";
import Layout from "@layouts/Layout.astro";
import Container from "@components/container.astro";

// Get ALL blog posts without filtering
const allPosts = await getCollection("blog");

// Get filtered posts for each language
const viPosts = await getCollection("blog", ({ id, data }) => {
  return id.startsWith("vi/") && !id.endsWith('keep') && !data.draft;
});

const idPosts = await getCollection("blog", ({ id, data }) => {
  return id.startsWith("id/") && !id.endsWith('keep') && !data.draft;
});

const msPosts = await getCollection("blog", ({ id, data }) => {
  return id.startsWith("ms/") && !id.endsWith('keep') && !data.draft;
});

const enPosts = await getCollection("blog", ({ id, data }) => {
  return id.startsWith("en/") && !id.endsWith('keep') && !data.draft;
});
---

<Layout title="Blog Debug Info">
  <Container>
    <div class="py-20">
      <h1 class="text-4xl font-bold mb-8">Blog Content Debug Information</h1>
      
      <div class="space-y-8">
        <!-- Summary -->
        <div class="bg-gray-100 dark:bg-gray-800 p-6 rounded-lg">
          <h2 class="text-2xl font-bold mb-4">Summary</h2>
          <ul class="space-y-2">
            <li><strong>Total posts:</strong> {allPosts.length}</li>
            <li><strong>Vietnamese (vi):</strong> {viPosts.length} posts</li>
            <li><strong>Indonesian (id):</strong> {idPosts.length} posts</li>
            <li><strong>Malay (ms):</strong> {msPosts.length} posts</li>
            <li><strong>English (en):</strong> {enPosts.length} posts</li>
          </ul>
        </div>

        <!-- All Posts Details -->
        <div class="bg-white dark:bg-gray-900 p-6 rounded-lg">
          <h2 class="text-2xl font-bold mb-4">All Posts (Raw Data)</h2>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
              <thead>
                <tr>
                  <th class="px-4 py-2 text-left">ID</th>
                  <th class="px-4 py-2 text-left">Slug</th>
                  <th class="px-4 py-2 text-left">Title</th>
                  <th class="px-4 py-2 text-left">Draft</th>
                  <th class="px-4 py-2 text-left">Publish Date</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                {allPosts.map((post) => (
                  <tr>
                    <td class="px-4 py-2 text-sm font-mono">{post.id}</td>
                    <td class="px-4 py-2 text-sm font-mono">{post.slug}</td>
                    <td class="px-4 py-2 text-sm">{post.data.title}</td>
                    <td class="px-4 py-2 text-sm">{post.data.draft ? 'Yes' : 'No'}</td>
                    <td class="px-4 py-2 text-sm">{post.data.publishDate.toLocaleDateString()}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>

        <!-- Vietnamese Posts -->
        {viPosts.length > 0 && (
          <div class="bg-blue-50 dark:bg-blue-900 p-6 rounded-lg">
            <h2 class="text-2xl font-bold mb-4">Vietnamese Posts (Filtered)</h2>
            <ul class="space-y-2">
              {viPosts.map((post) => (
                <li class="text-sm">
                  <strong>ID:</strong> {post.id} | 
                  <strong>Slug:</strong> {post.slug} | 
                  <strong>Title:</strong> {post.data.title}
                  <br />
                  <strong>URL:</strong> <code>/vi/blog/{post.id.replace('vi/', '').replace('.md', '')}</code>
                </li>
              ))}
            </ul>
          </div>
        )}

        <!-- Indonesian Posts -->
        {idPosts.length > 0 && (
          <div class="bg-green-50 dark:bg-green-900 p-6 rounded-lg">
            <h2 class="text-2xl font-bold mb-4">Indonesian Posts (Filtered)</h2>
            <ul class="space-y-2">
              {idPosts.map((post) => (
                <li class="text-sm">
                  <strong>ID:</strong> {post.id} | 
                  <strong>Slug:</strong> {post.slug} | 
                  <strong>Title:</strong> {post.data.title}
                  <br />
                  <strong>URL:</strong> <code>/id/blog/{post.id.replace('id/', '').replace('.md', '')}</code>
                </li>
              ))}
            </ul>
          </div>
        )}

        <!-- Malay Posts -->
        {msPosts.length > 0 && (
          <div class="bg-purple-50 dark:bg-purple-900 p-6 rounded-lg">
            <h2 class="text-2xl font-bold mb-4">Malay Posts (Filtered)</h2>
            <ul class="space-y-2">
              {msPosts.map((post) => (
                <li class="text-sm">
                  <strong>ID:</strong> {post.id} | 
                  <strong>Slug:</strong> {post.slug} | 
                  <strong>Title:</strong> {post.data.title}
                  <br />
                  <strong>URL:</strong> <code>/ms/blog/{post.id.replace('ms/', '').replace('.md', '')}</code>
                </li>
              ))}
            </ul>
          </div>
        )}

        <!-- Diagnostics -->
        <div class="bg-yellow-50 dark:bg-yellow-900 p-6 rounded-lg">
          <h2 class="text-2xl font-bold mb-4">Diagnostic Checks</h2>
          <ul class="space-y-2">
            <li>✓ Content collection is accessible: <code>{allPosts.length > 0 ? 'YES' : 'NO'}</code></li>
            <li>✓ Posts have required fields: <code>{allPosts.every(p => p.data.title && p.data.publishDate) ? 'YES' : 'NO - MISSING FIELDS'}</code></li>
            <li>✓ Draft posts exist: <code>{allPosts.some(p => p.data.draft) ? 'YES' : 'NO'}</code></li>
            <li>✓ Language folders detected: 
              <ul class="ml-6 mt-2">
                <li>- vi/: {allPosts.some(p => p.id.startsWith('vi/')) ? 'YES' : 'NO'}</li>
                <li>- id/: {allPosts.some(p => p.id.startsWith('id/')) ? 'YES' : 'NO'}</li>
                <li>- ms/: {allPosts.some(p => p.id.startsWith('ms/')) ? 'YES' : 'NO'}</li>
                <li>- en/: {allPosts.some(p => p.id.startsWith('en/')) ? 'YES' : 'NO'}</li>
              </ul>
            </li>
          </ul>
        </div>

        <div class="text-center py-8">
          <p class="text-gray-500 mb-4">This is a temporary debug page. Delete it after fixing the issues.</p>
          <a href="/" class="text-blue-600 hover:underline">Back to Home</a>
        </div>
      </div>
    </div>
  </Container>
</Layout>